{% extends "base.html" %}
{% block title %}ìŒì‹ì  ì¶”ì²œ{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/food.css') }}">
{% endblock %}

{% block content %}
<div class="grid-layout">
  <!-- ğŸ”¹ ì™¼ìª½: ì…ë ¥ì°½ + ìŒì‹ì  ë¦¬ìŠ¤íŠ¸ -->
  <div class="left-panel">
    <h3>ì§€ì—­ ì…ë ¥</h3>
    <form method="POST">
      <input type="text" name="region" placeholder="ì˜ˆ: ì„œìš¸ ê°•ë‚¨ì—­" required>
      <button type="submit">ê²€ìƒ‰</button>
    </form>

    <ul class="place-list">
      {% for place in places %}
      <li class="place-item" data-lat="{{ place.lat }}" data-lng="{{ place.lng }}">
        <strong>{{ place.name }}</strong><br>
        <small>{{ place.address }}</small>
      </li>
      {% endfor %}
    </ul>
  </div>

  <!-- ğŸ”¹ ê°€ìš´ë°: ì¹´ì¹´ì˜¤ ì§€ë„ -->
  <div class="center-panel">
    <h3>ì§€ë„</h3>
    <div id="map" style="width: 100%; height: 500px;"></div>
  </div>

  <!-- ğŸ”¹ ì˜¤ë¥¸ìª½: GPT ìœ íŠœë¸Œ ì¶”ì²œ -->
<div class="right-panel">
  <h3>ìœ íŠœë¸Œ ë§›ì§‘ ì¶”ì²œ</h3>
  <ul class="youtube-list">
    {% for video in youtube_videos %}
    <li style="margin-bottom: 16px;">
      <a href="{{ video.url }}" target="_blank">
        <img src="{{ video.thumbnail }}" width="100%" style="border-radius: 8px;"><br>
        <strong>{{ video.title }}</strong>
      </a>
    </li>
    {% endfor %}
  </ul>
</div>
<!-- Kakao ì§€ë„ API ë¶ˆëŸ¬ì˜¤ê¸° -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey={{ kakao_key }}&autoload=false"></script>
<script>
kakao.maps.load(function () {
  const mapContainer = document.getElementById('map');
  const center = new kakao.maps.LatLng({{ center_lat }}, {{ center_lng }});
  const map = new kakao.maps.Map(mapContainer, {
    center: center,
    level: 5
  });

  const markerList = [];

  // place-listì˜ ê° í•­ëª© ë°˜ë³µ
  document.querySelectorAll('.place-item').forEach(item => {
    const lat = parseFloat(item.dataset.lat);
    const lng = parseFloat(item.dataset.lng);
    const name = item.querySelector('strong').innerText;

    const pos = new kakao.maps.LatLng(lat, lng);

    // ë§ˆì»¤ ìƒì„±
    const marker = new kakao.maps.Marker({
      map: map,
      position: pos
    });

    // ì¸í¬ìœˆë„ìš° ìƒì„±
    const info = new kakao.maps.InfoWindow({
      content: `<div style="padding:6px;font-size:13px;"><b>${name}</b></div>`
    });

    // ë§ˆì»¤ ì €ì¥
    markerList.push({ marker, info });

    // ë§ˆì»¤ í´ë¦­ ì‹œ ì¸í¬ìœˆë„ìš° ì—´ê¸°
    kakao.maps.event.addListener(marker, 'click', () => {
      markerList.forEach(m => m.info.close()); // ê¸°ì¡´ ì°½ ë‹«ê¸°
      info.open(map, marker);
    });

    // ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ í´ë¦­ ì‹œ ì§€ë„ ì´ë™ + ë§ˆì»¤ ì¸í¬ìœˆë„ìš° ì—´ê¸°
    item.addEventListener('click', () => {
      map.setCenter(pos);
      map.setLevel(4); // í™•ëŒ€ ë ˆë²¨ ì¡°ì •
      markerList.forEach(m => m.info.close());
      info.open(map, marker);
    });
  });
});
</script>

{% endblock %}

